//CJLDialogBox by Cres Jie Labasano under MIT License
(function($,w){var AbstractModal=function(e){var t=function(){},n=null;var r={modalType:"modal",index:0};var i={title:n,content:n,type:n,buttons:n,position:n,contentCss:{width:350,height:250,padding:20},containerCss:{"z-index":9999999,position:"fixed"},onShow:t,onClose:t,afterShow:t,afterClose:t,overlay:false,draggable:false,overlayOnClickClose:true,transitionIn:{style:"fadeIn"},transitionOut:{style:"fadeOut"}};var s={$container:$("<div class='cjl-db-container' id='cjl_db_container_"+$.cjlDialog_count+"'></div>"),$header:$("<div class='cjl-db-header'></div>"),$closeBtn:$('<button class="cjl-db-close">&#10006;</button>'),$contentWrapper:$('<div class="cjl-db-content-wrapper"></div>'),$content:$('<div class="cjl-db-content"></div>'),$contentType:$('<div class="type"></div>'),$footer:$('<div class="cjl-db-footer"></div>'),$footerWrapper:$('<div class="cjl-db-footer-wrapper"></div>'),$overlay:$('<div class="cjl-db-overlay"></div>')};var o=function(){s.$header.append("<h3>"+i.title+"</h3>");s.$header.append(s.$closeBtn);if(i.type){s.$contentWrapper.append(s.$contentType.addClass(e.type).css("width",60))}s.$content.append(i.content).css(i.contentCss);s.$contentWrapper.append(s.$content);if(i.buttons){for(var t in i.buttons){var n=i.buttons[t];$button=$("<button></button>");for(var r in n)$button[r](n[r]);s.$footerWrapper.append($button)}s.$footer.append(s.$footerWrapper);s.$container.append(s.$footer)}var o=(i.type?s.$contentType.outerWidth():0)+s.$content.outerWidth();s.$container.append([s.$header,s.$contentWrapper,s.$footer]).css("width",o);s.$header.css("width",o);s.$contentWrapper.css("width",o);s.$footer.css("width",o)};var u=function(){if(i.position){if(typeof i.position=="object")s.$container.css(i.position);else if(typeof e.position=="function")i.position(s.$container)}else s.$container.css($.centerLocation(s.$container))};var a=function(){if(i.overlay){$("html").css("overflow","hidden")}$.cjlDialog_current.push(this);r.index=$.cjlDialog_current.length-1;s.$container.css(i.containerCss).attr({"data-cjldb-status":"open","data-cjldb-gindex":r.index});i.draggable?s.$container.draggable():"";i.onShow(s.$container);if(typeof i.transitionIn=="function")i.transitionIn(s.$container,i.afterShow);else if(typeof i.transitionIn=="object"){var e=i.transitionIn;e.mode="show";e.complete=i.afterShow;if(!s.$container[i.transitionIn.style])i.transitionIn.style="fadeIn";s.$container[i.transitionIn.style](e)}};var f=function(e){e=typeof e!=="function"?t:e;i.onClose(s.$container);if(typeof i.transitionOut=="function")i.transitionOut(s.$container.attr("data-cjlDB-status","close"),remove);else if(typeof i.transitionOut=="object"){var n=i.transitionOut;n.mode="hide";n.complete=e;if(!s.$container[i.transitionOut.style])i.transitionOut.style="fadeOut";s.$container[i.transitionOut.style](n).attr("data-cjlDB-status","close")}$.cjlDialog_current.splice(r.index,1);h(r.index)};var l=function(e){s.$closeBtn.on("click",p);if(i.overlayOnClickClose){s.$overlay.on("click",p)}};var c=function(){var e=$("body");if(i.overlay){if(r.modalType=="modal")e.prepend(s.$overlay.attr("z-index",999));else e.append(s.$overlay)}if(r.modalType!=="modal"){e.append(s.$container)}};var h=function(e){for(;e<$.cjlDialog_current.length;e++){var t=$.cjlDialog_current[e];t.privates.index--;t.template.$container.attr("data-cjldb-gindex",t.privates.index)}};var p=function(){f(function(){if(i.overlay){$("html").css("overflow","auto");s.$overlay.remove()}if(r.modalType!="modal")s.$container.remove();i.afterClose()})};var d=function(t){for(var n in e)i[n]=e[n]};d(e);this.defaults=i;this.privates=r;this.template=s;this.options=d;this.addGist=o;this.addToBody=c;this.addCloseEvent=l;this.closeAnimation=f;this.positionContainer=u;this.close=p;this.showContainer=a;return this};var centerLocation=function(e){var t=window.innerWidth/2-e.outerWidth()/2,n=window.innerHeight/2-e.outerHeight()/2;return{top:n,left:t}};var cjlDialog=function(e){var t=new AbstractModal(e);t.privates.modalType="dialog";t.addGist();t.addCloseEvent();t.addToBody();t.positionContainer();t.showContainer();$.cjlDialog_count++};$.extend({cjlDialog:cjlDialog,cjlDialog_count:0,centerLocation:centerLocation,cjlDialog_current:[]});$.fn.cjlModal=function(e){if(!e)e={};e.overlay=typeof e.overlay==="undefined"?true:e.overlay;var t=new AbstractModal(e);t.template.$container=this;this.open=function(){t.addToBody();t.addCloseEvent();t.positionContainer();t.showContainer();return this};this.close=function(){t.closeAnimation();return this};this.options=function(e){t.options(e);return this};return this};$(document).click(function(e){var $el=$(e.target);switch($el.attr("data-cjlmodal")){case"open":e.preventDefault();$($el.attr("href")).cjlModal(eval("("+$el.attr("data-cjlmodal-opt")+")")).open();break;case"close":e.preventDefault();$.cjlDialog_current[$el.parents('*[data-cjldb-status="open"]').attr("data-cjldb-gindex")].close()}}).keyup(function(e){switch(e.keyCode){case 27:if($.cjlDialog_current.length)$.cjlDialog_current[$.cjlDialog_current.length-1].close();break}})})(jQuery,this)